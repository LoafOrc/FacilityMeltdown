<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="Current" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <PropertyGroup>
    <LethalCompanyDir>C:/Program Files (x86)/Steam/steamapps/common/Lethal Company/</LethalCompanyDir>
    <TestProfileDir>$(LethalCompanyDir)</TestProfileDir>
    <UnityProjectDir>D:/LethalCompanyMods/LethalCompanyUnity/</UnityProjectDir>
  </PropertyGroup>

  <Target Name="RestoreLatestAssetBundle" BeforeTargets="PackThunderstore">
    <Message Importance="high" Text="Getting Asset Bundle" />
    <Copy SourceFiles="$(UnityProjectDir)AssetBundles/StandaloneWindows/facilitymeltdown" DestinationFolder="$(ProjectDir)assets/bundles" />
  </Target>

  <Target Name="CopyToTestProfile" DependsOnTargets="NetcodePatch;RestoreLatestAssetBundle" AfterTargets="PostBuildEvent" Condition="true">
    <MakeDir
      Directories="$(TestProfileDir)BepInEx/plugins/loaforc-FacilityMeltdown/FacilityMeltdown"
      Condition="!Exists('$(TestProfileDir)BepInEx/plugins/loaforc-FacilityMeltdown/FacilityMeltdown')"
    />
    <ItemGroup>
      <TestProfileStageFiles Include="$(TargetPath)"/>
      <TestProfileStageFiles Include="$(ProjectDir)assets/bundles/facilitymeltdown"/>
    </ItemGroup>
    <Copy SourceFiles="@(TestProfileStageFiles)" DestinationFolder="$(TestProfileDir)BepInEx/plugins/loaforc-FacilityMeltdown/FacilityMeltdown" />
  </Target>

  <Target Name="CopyToUnity" DependsOnTargets="NetcodePatch" AfterTargets="PostBuildEvent">
    <Message Importance="high" Text="Copying to unity project." />
    <Copy SourceFiles="$(TargetPath)" DestinationFolder="$(UnityProjectDir)Assets/FacilityMeltdown/" />
  </Target>
</Project>
